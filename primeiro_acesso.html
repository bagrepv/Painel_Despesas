<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Primeiro Acesso</title>
    <!-- Inclui os ícones do Material Design -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Link para seu arquivo CSS personalizado -->
    <link rel="stylesheet" href="primeiro_acesso.css">
</head>
<body>
    <!-- Overlay do modal para escurecer o fundo -->
    <div id="modal-perfil" class="modal-overlay">
        <!-- Conteúdo principal do modal -->
        <div class="modal-content">

            <!-- Botão para fechar o modal -->
            <a href="#" class="close-btn">&times;</a>

            <!-- Formulário de cadastro - Adicionado um ID para ser manipulado pelo JavaScript -->
            <form id="primeiroAcessoForm">
                <h2><span class="material-icons">person</span> Informações Pessoais</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="nome"><span class="material-icons">badge</span> Nome Completo</label>
                        <input type="text" id="nome" name="nome" required />
                    </div>
                    <div class="form-group">
                        <label for="cpf"><span class="material-icons">fingerprint</span> CPF</label>
                        <input type="text" id="cpf" name="cpf" required />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="email"><span class="material-icons">email</span> E-mail</label>
                        <input type="email" id="email" name="email" required />
                    </div>

                    <div class="form-group">
                        <label for="telefone"><span class="material-icons">phone</span> Telefone</label>
                        <input type="tel" id="telefone" name="telefone" />
                    </div>
                </div>

                <div class="form-group">
                    <label for="senha"><span class="material-icons">lock</span> Senha</label>
                    <input type="password" id="senha" name="senha" class="senha-curta" required />
                </div>

                <div class="form-section">
                    <h2><span class="material-icons">work</span> Informações Profissionais</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="orgao"><span class="material-icons">business</span> Órgão</label>
                            <input type="text" id="orgao" name="orgao" required />
                        </div>
                        <div class="form-group">
                            <label for="setor"><span class="material-icons">groups</span> Setor</label>
                            <input type="text" id="setor" name="setor" required />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="cargo"><span class="material-icons">work_outline</span> Cargo/Função</label>
                        <input type="text" id="cargo" name="cargo" required />
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-save">
                        <span class="material-icons">save</span> Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Garante que o script só execute depois que o DOM estiver completamente carregado
        document.addEventListener('DOMContentLoaded', () => {
            // Lógica para exibir o modal se a URL tiver o hash '#modal-perfil'
            if (window.location.hash === '#modal-perfil') {
                document.getElementById('modal-perfil').style.display = 'flex'; // Altera para 'flex' para exibir
            }

            // Lógica para fechar o modal ao clicar no botão 'x'
            const closeBtn = document.querySelector('.close-btn');
            if (closeBtn) {
                closeBtn.addEventListener('click', (e) => {
                    e.preventDefault(); // Impede o comportamento padrão do link
                    document.getElementById('modal-perfil').style.display = 'none'; // Esconde o modal
                    // Opcional: remover o hash da URL para não reabrir automaticamente ao recarregar
                    history.replaceState(null, '', window.location.pathname);
                });
            }

            // Seleciona o formulário pelo ID
            const primeiroAcessoForm = document.getElementById('primeiroAcessoForm');

            // Adiciona um listener para o evento de submissão do formulário
            if (primeiroAcessoForm) {
                primeiroAcessoForm.addEventListener('submit', async (e) => {
                    e.preventDefault(); // Evita o comportamento padrão de recarregamento da página

                    // Coleta todos os valores dos campos do formulário
                    const formData = {
                        nome: document.getElementById('nome').value,
                        cpf: document.getElementById('cpf').value,
                        email: document.getElementById('email').value,
                        telefone: document.getElementById('telefone').value,
                        senha: document.getElementById('senha').value, // A senha será hasheada no backend
                        orgao: document.getElementById('orgao').value,
                        setor: document.getElementById('setor').value,
                        cargo: document.getElementById('cargo').value
                    };

                    // URL do seu endpoint de cadastro no backend (Render)
                    const backendURL = 'https://painel-despesas.onrender.com/api/sign-up';

                    try {
                        // Envia os dados para o backend usando a Fetch API
                        const response = await fetch(backendURL, {
                            method: 'POST', // Método HTTP POST para enviar dados
                            headers: {
                                'Content-Type': 'application/json' // Indica que o corpo da requisição é JSON
                            },
                            body: JSON.stringify(formData) // Converte o objeto JS para uma string JSON
                        });

                        const data = await response.json(); // Tenta analisar a resposta como JSON

                        if (response.ok) { // Verifica se a resposta foi um sucesso (status 2xx)
                            alert('Cadastro realizado com sucesso! Você pode fazer login agora.');
                            // Opcional: redirecionar para a página de login após o cadastro
                            window.location.href = 'login.html';
                        } else {
                            // Se o backend retornou um erro (ex: e-mail já existe, validação)
                            alert(`Erro no cadastro: ${data.message || 'Ocorreu um erro desconhecido.'}`);
                            console.error('Erro no cadastro (resposta do servidor):', data);
                        }
                    } catch (error) {
                        // Captura erros de rede ou outros problemas na requisição
                        alert('Não foi possível conectar ao servidor. Verifique sua conexão ou tente novamente mais tarde.');
                        console.error('Erro na requisição de cadastro (frontend):', error);
                    }
                });
            }
        });
    </script>
</body>
</html>
